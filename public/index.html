<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Human Verification</title>
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  <style>
    body { font-family: Arial; display:flex; justify-content:center; align-items:center; height:80vh;}
    .g-recaptcha { display: flex; justify-content: center; margin: 20px 0; }
    .error { color: red; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="box">
    <div class="g-recaptcha" data-sitekey="6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI" data-callback="handleCaptchaChange"></div>
    <div id="error-message" class="error" style="display: none;"></div>
  </div>

  <script>
    async function handleCaptchaChange(token) {
      if (!token) {
        showError('Please complete the CAPTCHA');
        return;
      }

      try {
        const response = await fetch('/api/verify-captcha', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token }),
        });

        const data = await response.json();
        
        if (data.success) {
          document.cookie = "captcha_pass=verified; path=/; max-age=86400";
          window.location.href = '/real';
        } else {
          showError('CAPTCHA verification failed. Try again.');
          grecaptcha.reset();
        }
      } catch (error) {
        showError('Verification failed. Please try again.');
        grecaptcha.reset();
      }
    }

    function showError(message) {
      const errorDiv = document.getElementById('error-message');
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
    }
  </script>
</body>
</html>
